{% extends "base_plugin.html" %}
{% block scripts %}
{{ super() }}
<script>
function mainpage() {
  var url = window.location.href;
  var page = url.substring(url.lastIndexOf('/') + 1);
  var final = url.replace(page, '');
  if ( url.includes("?action=") ) {
    window.location.href = final;
  };
}
</script>
{% endblock scripts %}
{% set logo_frame = false %}


{% set item_count = p.__items|length %}
{% set tab1title = "<strong>StateEngine</strong>" %}
{% set tabcount = 1 %}

{% block headtable %}

<table class="table table-striped table-hover">
  <tbody>
    <tr>
      <td class="py-1"><strong>Log Level</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_level') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Log Folder</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_directory') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Startup Delay</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('startup_delay_default') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Suspend Time</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('suspend_time_default') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Items</strong></td>
      <td class="py-1">{{ item_count }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"></td>
      <td class="py-1"></td>
    </tr>
  </tbody>
</table>
{% endblock headtable %}


{% block bodytab1 %}

<div class="container-fluid m-2" style="position: relative;">
  <div style="float: left; border:1px solid black; width:200px; position: sticky; position: -webkit-sticky; top:220px; left:0;">
    <a href="https://www.smarthomeng.de/starting-with-state-machine-automation-stateengine-plugin" target="link">Einführung</a><br>
    <a href="?page=doku1">Grundsätzliches</a><br>
    <a href="?page=doku2">Plugin-Konfiguration</a><br>
    <a href="?page=doku3">Das Objekt-Item</a><br>
    <a href="?page=doku4">Das Zustands-Item</a><br>
    <a href="?page=doku5">Bedingungen</a><br>
    <a href="?page=doku6">Aktionen: Ausführung</a><br>
    <a href="?page=doku7">Aktionen: Einzelangabe</a><br>
    <a href="?page=doku8">Aktionen: Combo-Angabe</a><br>
    <a href="?page=doku9">Zustand-Templates</a><br>
    <a href="?page=doku10">Vordefinierte Funktionen</a><br>
    <a href="?page=doku11">Variablen</a><br>
    <a href="?page=doku12">Sperr-Zustand</a><br>
    <a href="?page=doku13">Pausiert-Zustand</a><br>
    <a href="?page=doku14">CLI Kommandos</a><br>
    <a href="?page=doku15">Vollständiges Beispiel</a><br>
  </div>
  <div style="margin-left:230px; max-width: 800px;">
    <h1 id="aktionenkombiniertevariante">Aktionen - Kombinierte Variante</h1>

    <p>Bei der kombinierten Variante zur Definition von Aktionen werden alle Parameter einer Aktion in einem Attribut definiert. Über den Aktionsnamen werden lediglich eventuelle Items zugeordnet.
    Die einzelnen Parameter werden bei conf-Files in der Listenschreibweise mit dem Zeichen <code>|</code> getrennt aufgelistet:</p>

    <pre><code> se_action_&lt;Aktionsname&gt;: function: &lt;func&gt; | (evtl. Detailparameter zur Funktion) | delay: &lt;delay&gt; | order: &lt;order&gt; | repeat: &lt;repeat&gt;
    </code></pre>

    <p>Bei yaml Files werden die Parameter mittels Aufzählungszeichen "-" untereinander definiert:</p>

    <pre><code> se_action_&lt;Aktionsname&gt;:
        - function: &lt;func&gt;
        - Detailparameter der Funktion, z.B. "to: .."
        - delay: &lt;delay&gt;
        - order: &lt;order&gt;
        - repeat: &lt;repeat&gt;
    </code></pre>

    <p>Die Parameter haben dabei folgende Bedeutung:</p>

    <h2 id="delaydelay">delay: <code>&lt;delay&gt;</code></h2>

    <p>Über <code>&lt;delay&gt;</code> wird die Verzögerung angegeben, nach der die Aktion ausgeführt werden soll. </p>

    <p>Der Parameter ist optional und kann auch weggelassen werden. In diesem Fall wird die Aktion sofort ausgeführt.</p>

    <p>Die Angabe erfolgt in Sekunden oder mit dem Suffix "m" in Minuten.</p>

    <pre><code>    delay: 30         --&gt; 30 Sekunden
        delay: 30m        --&gt; 30 Minuten
    </code></pre>

    <p>Der Timer zur Ausführung der Aktion nach der angegebenen Verzögerung wird entfernt, wenn eine gleichartike Aktion ausgeführt werden soll (egal ob verzögert oder nicht). Wenn also die Verzögerung größer als der "<code>cycle</code>" ist, wird die Aktion nie durchgeführt werden, es sei denn die Aktion soll nur einmalig ausgeführt werden. <br />
    Für den Wert von <code>&lt;delay&gt;</code> wird der [[Datentyp AbValue|Doku-De-Grundsaetzliches-AbValue]] verwendet.</p>

    <h2 id="repeatrepeat">repeat: <code>&lt;repeat&gt;</code></h2>

    <pre><code>    se_repeat_&lt;Aktionsname&gt;
    </code></pre>

    <p>Über das Attribut wird unabhängig vom globalen Setting für das stateengine Item festgelegt, ob eine Aktion auch beim erneuten Eintritt in den Status ausgeführt wird oder nicht.</p>

    <pre><code>    se_delay_&lt;Aktionsname&gt;: True    # Aktion wird bei jedem Mal aufs neue ausgeführt
        se_delay_&lt;Aktionsname&gt;: False   # Aktion wird nur beim ersten Eintritt in den Status ausgeführt
    </code></pre>

    <h2 id="orderorder">order: <code>&lt;order&gt;</code></h2>

    <p>Die Reihenfolge, in der die Aktionen ausgeführt werden, ist nicht zwingend die Reihenfolge in der die Attribute definiert sind. In den meisten Fällen ist dies kein Problem da die Aktionen voneinander unabhängig sind und daher in beliebiger Reihenfolge ausgeführt werden können. In Einzelfällen kann es jedoch erforderlich sein, mehrere Aktionen in einer bestimmten Reihenfolge auszuführen. Dies kann über den Parameter <code>order: &lt;order&gt;</code> erfolgen. Mit diesem Attribut wird der Aktion eine Zahl zugewiesen. Aktionen werden in aufsteigender Reihenfolge der zugewiesenen Zahlen ausgeführt.</p>

    <p>Der Parameter ist optional und kann auch weggelassen werden. Für Aktionen, denen keine Reihenfolge explizit zugewiesen wurde, wird der Reihenfolgenwert 1 verwendet.</p>

    <p>Es ist möglich zwei Aktionen die gleiche Zahl zuzuweisen, die Reihenfolge der beiden Aktionen untereinander ist dann wieder undefiniert. Innerhalb der gesamten Aktionen werden die beiden Aktionen jedoch an der angegebenen Position ausgeführt.</p>

    <p>Für den Wert von <code>&lt;order&gt;</code> wird der [[Datentyp AbValue|Doku-De-Grundsaetzliches-AbValue]] verwendet.</p>

    <h2 id="functionfunc">function: <code>&lt;func&gt;</code></h2>

    <p>Mit dem Parameter <code>&lt;func&gt;</code> wird die auszuführende Funktion festgelegt. In Abhängigkeit zur gewählten Funktion werden zusätzliche Detailparameter erforderlich. <br />
    Folgende Werte sind möglich:</p>

    <h3 id="funktionsetitemaufeinenwertsetzen">Funktion <code>set</code>: Item auf einen Wert setzen</h3>

    <pre><code>se_action_&lt;Aktionsname&gt;: function: set | to: &lt;val&gt; | force: [True/False]
    </code></pre>

    <p>Das Item, dass verändert werden soll, muss auf Ebene des Objekt-Items über das Attribut "<code>se_item_&lt;Aktionsname&gt;</code>" angegeben werden. </p>

    <p>Der Parameter <code>to: &lt;val&gt;</code> legt fest, auf welchen Wert das Item gesetzt werden soll. Für <code>&lt;val&gt;</code> wird der [[Datentyp AbValue|Doku-De-Grundsaetzliches-AbValue]] verwendet. Der Wert, auf den das Item gesezt wird kann dadurch als statischer Wert, als Wert eines Items oder als Ergebnis der Ausführung einer Funktion festgelegt werden.</p>

    <p><strong>Erzwingen der Wertänderung:</strong>
    Über den optionalen Parameter <code>force: [True/False]</code> kann eine Wertänderung erzwungen werden: Wenn das Item bereits den zu setzenden Wert hat, dann ändert smarthomeNG das Item nicht. Selbst wenn beim Item das Attribut <code>enforce_updates = yes</code> gesetzt ist, wird zwar der Wert neu gesetzt, der von smarthomeNG Änderungszeit nicht neu gesetzt. Wird der Parameter <code>force: True</code> gesetzt, so wird das Plugin den Wert des Items bei Bedarf zuerst auf einen anderen Wert ändern und dann auf dem Zielwert setzen. Damit erfolgt auf jeden Fall eine Wertänderung (ggf. sogar zwei) mit allen damit in Zusammenhang stehenden Änderungen (eval's, Aktualisierung der Änderungszeiten, etc).</p>

    <p><strong>Minimumabweichung:</strong>
    Es ist möglich eine Minimumabweichung für Änderungen zu definieren. Wenn die Differenz zwischen dem aktuellen Wert des Items und dem ermittelten neuen Wert kleiner ist als die festgelegte Minimumabweichung wird keine Änderung vorgenommen. Die Minimumabweichung wird über das Attribut "<code>se_mindelta_&lt;Aktionsname&gt;</code>" auf der Ebene des Objekt-Items festgelegt. Auch hier wird der [[Datentyp AbValue|Doku-De-Grundsaetzliches-AbValue]] verwendet.</p>

    <h3 id="funktionrunausfhreneinerfunktion">Funktion <code>run</code>: Ausführen einer Funktion</h3>

    <pre><code>se_action_&lt;Aktionsname&gt;: function: run | eval:(Funktion)
    </code></pre>

    <p>Die Angabe ist vergleichbar mit dem Ausführen einer Funktion zur Ermittlung des Werts für ein Item, hier wird jedoch kein Item benötigt. Außerdem wird der Rückgabewert der Funktion ignoriert.</p>

    <h3 id="funktiontriggerauslseneinerlogikausfhrung">Funktion <code>trigger</code>: Auslösen einer Logikausführung</h3>

    <pre><code>se_action_&lt;Aktionsname&gt;: function: trigger | logic: &lt;Logikname&gt; | value: &lt;Wert&gt;
    </code></pre>

    <p>Löst die Ausführung der Logik <code>&lt;Logikname&gt;</code>aus. Um beim Auslösen einen Wert an die Logik zu übergeben, kann dieser Wert über die Angabe von <code>value: &lt;Wert&gt;</code> hinter dem Logiknamen angegeben werden. Wenn kein Wert übergeben werden soll lässt man den Teil weg.</p>

    <h3 id="funktionbyattralleitemsdieeinbestimmtesattributhabenaufdenwertdiesesattributssetzen">Funktion <code>byattr</code>: Alle Items, die ein bestimmtes Attribut haben, auf den Wert dieses Attributs setzen</h3>

    <pre><code>se_action_&lt;Aktionsname&gt;: function: byattr | attribute: &lt;Attributname&gt;
    </code></pre>

    <p>Mit dieser Funktion wird der Name eines anderen (beliebigen) Attributs angegeben. Beim Ausführen werden alle Items herausgesucht, die das angegebene Attribut enthalten. Diese Items werden auf den Wert gesetzt, der dem genannten Attribut in den Items jeweils zugewiesen ist.</p>

    <p><strong>Beispiel:</strong></p>

    <pre><code>    se_action_&lt;Aktionsname&gt;: function: byattr | attribute: mein_eigenes_Attribut
    </code></pre>

    <p>sucht alle Items heraus, bei denen das Attribut "<code>mein_eigenes_Attribut</code>" angegeben ist.
    Ein Item</p>

    <pre><code>    dummy1:
            type: num
            mein_eigenes_Attribut: 42
    </code></pre>

    <p>wird dann auf "<code>42</code>" gesetzt. <br />
    Ein anderes Item</p>

    <pre><code>    dummy2:
            type: str
            mein_eigenes_Attribut: Rums
    </code></pre>

    <p>wird gleichzeitig auf "<code>Rums</code>" gesetzt.</p>

    <h3 id="funktionspecialsondervorgnge">Funktion <code>special</code>: Sondervorgänge</h3>

    <pre><code>se_action_&lt;Aktionsname&gt;: function: special | value: &lt;Sondervorgang&gt;
    </code></pre>

    <p>Für bestimmte Sondervorgänge sind besondere Aktionen im Plugin definiert (z. B. für das Suspend). Diese werden jedoch nicht hier erläutert, sondern an den Stellen, andenen Sie verwendet werden.</p>

    <h2 id="beispielzuaktionen">Beispiel zu Aktionen</h2>

    <pre><code>beispiel:
        raffstore:
            automatik:
                rules:
                    &lt;...&gt;
                    se_item_height: beispiel.raffstore1.hoehe
                    se_mindelta_height: 10
                    se_item_lamella: beispiel.raffstore1.lamelle
                    se_mindelta_lamella: 5
                    Daemmerung:
                        &lt;...&gt;
                        se_action_height: function: set | to: value:100
                        se_action_lamella: function: set | to: value:25
                        &lt;...&gt;
                    Nacht:
                        &lt;...&gt;
                        se_action_height: function: set | to: value:100
                        se_action_lamella: function: set | to: value:0
                        &lt;...&gt;
                    Nachfuehren:
                        &lt;...&gt;
                        se_action_height: function: set | to: value:100
                        se_action_lamella: function: set | to: eval:stateengine_eval.sun_tracking()
                        &lt;...&gt;
                    Sonder:
                        &lt;...&gt;
                        se_action_logic1: function: trigger | logic: myLogic | value:42 | delay: 10
                        &lt;...&gt;
    </code></pre>
  </div>
</div>
{% endblock bodytab1 %}
