{% extends "base_plugin.html" %}
{% block scripts %}
{{ super() }}
<script>
function mainpage() {
  var url = window.location.href;
  var page = url.substring(url.lastIndexOf('/') + 1);
  var final = url.replace(page, '');
  if ( url.includes("?action=") ) {
    window.location.href = final;
  };
}
</script>
{% endblock scripts %}
{% set logo_frame = false %}


{% set item_count = p.__items|length %}
{% set tab1title = "<strong>StateEngine</strong>" %}
{% set tabcount = 1 %}

{% block headtable %}

<table class="table table-striped table-hover">
  <tbody>
    <tr>
      <td class="py-1"><strong>Log Level</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_level') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Log Folder</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_directory') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Startup Delay</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('startup_delay_default') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Suspend Time</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('suspend_time_default') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Items</strong></td>
      <td class="py-1">{{ item_count }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"></td>
      <td class="py-1"></td>
    </tr>
  </tbody>
</table>
{% endblock headtable %}


{% block bodytab1 %}

<div class="container-fluid m-2" style="position: relative;">
  <div style="float: left; border:1px solid black; width:200px; position: sticky; position: -webkit-sticky; top:220px; left:0;">
    <a href="https://www.smarthomeng.de/starting-with-state-machine-automation-stateengine-plugin" target="link">Einführung</a><br>
    <a href="?page=doku1">Grundsätzliches</a><br>
    <a href="?page=doku2">Plugin-Konfiguration</a><br>
    <a href="?page=doku3">Das Objekt-Item</a><br>
    <a href="?page=doku4">Das Zustands-Item</a><br>
    <a href="?page=doku5">Bedingungen</a><br>
    <a href="?page=doku6">Aktionen: Ausführung</a><br>
    <a href="?page=doku7">Aktionen: Einzelangabe</a><br>
    <a href="?page=doku8">Aktionen: Combo-Angabe</a><br>
    <a href="?page=doku9">Zustand-Templates</a><br>
    <a href="?page=doku10">Vordefinierte Funktionen</a><br>
    <a href="?page=doku11">Variablen</a><br>
    <a href="?page=doku12">Sperr-Zustand</a><br>
    <a href="?page=doku13">Pausiert-Zustand</a><br>
    <a href="?page=doku14">CLI Kommandos</a><br>
    <a href="?page=doku15">Vollständiges Beispiel</a><br>
  </div>
  <div style="margin-left:230px; max-width: 800px;">
    <h1 id="locksperrenderautomatischenzustandsermittlung">Lock - Sperren der automatischen Zustandsermittlung</h1>

    <p>Für das Sperren der automatischen Zustandsermittlung führt man ein Sperr-Item ein, dass beispielsweise über einen Taster änderbar ist.</p>

    <p>Die Sperre soll aktiv sein, wenn das Sperr-Item den Wert <code>True</code> hat.</p>

    <h2 id="dassperritem">Das Sperr-Item</h2>

    <p>Das Sperritem definiert man wie folgt:</p>

    <pre><code>beispiel:
        lock:
            item:
                type: bool
                name: Sperr-Item
                visu_acl: rw
                cache: on
    </code></pre>

    <h2 id="dersperrzustand">Der Sperrzustand</h2>

    <p>Der Sperrzustand geht allen anderen Zuständen vor und wird deshalb als erster Zustand definiert. </p>

    <p>Zudem muss eine Änderung des Sperr-Items direkt eine Zustandsermittlung auslösen, das Sperr-Item wird daher in die Liste der <code>eval_trigger</code> aufgenommen.</p>

    <p>Einstiegsbedingung für den Sperrzustand ist nun einfach, dass das Sperr-Item den Wert <code>True</code> hat. Für das Sperr-Item werden in diesem Beispiel keinerlei Aktionen definiert. Solange also das Sperr-Item aktiv ist, passiert: nichts.</p>

    <pre><code>beispiel:
        lock:
            rules:
                # Sperr-Item zu eval_trigger:
                eval_trigger: &lt;andere Einträge&gt; | beispiel.lock.item

                # Items für Bedingungen und Aktionen
                se_item_lock: beispiel.lock.item

                lock:
                    type: foo
                    name: Manuell gesperrt

                    enter:
                        se_value_lock: true
    </code></pre>

    <p>Bei der Zustandsermittlung die Reihenfolge der Definition der Zustände relevant. Da der Sperrzustand allen anderen Zuständen vorgeht ist er üblicherweise der erste Zustand in der Definition.</p>
  </div>
</div>
{% endblock bodytab1 %}
