{% extends "base_plugin.html" %}
{% block scripts %}
{{ super() }}
<script>
function mainpage() {
  var url = window.location.href;
  var page = url.substring(url.lastIndexOf('/') + 1);
  var final = url.replace(page, '');
  if ( url.includes("?action=") ) {
    window.location.href = final;
  };
}
</script>
{% endblock scripts %}
{% set logo_frame = false %}


{% set item_count = p.__items|length %}
{% set tab1title = "<strong>StateEngine</strong>" %}
{% set tabcount = 1 %}

{% block headtable %}

<table class="table table-striped table-hover">
  <tbody>
    <tr>
      <td class="py-1"><strong>Log Level</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_level') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Log Folder</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_directory') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Startup Delay</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('startup_delay_default') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Suspend Time</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('suspend_time_default') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Items</strong></td>
      <td class="py-1">{{ item_count }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"></td>
      <td class="py-1"></td>
    </tr>
  </tbody>
</table>
{% endblock headtable %}


{% block bodytab1 %}

<div class="container-fluid m-2" style="position: relative;">
  <div style="float: left; border:1px solid black; width:200px; position: sticky; position: -webkit-sticky; top:220px; left:0;">
    <a href="https://www.smarthomeng.de/starting-with-state-machine-automation-stateengine-plugin" target="link">Einführung</a><br>
    <a href="?page=doku1">Grundsätzliches</a><br>
    <a href="?page=doku2">Plugin-Konfiguration</a><br>
    <a href="?page=doku3">Das Objekt-Item</a><br>
    <a href="?page=doku4">Das Zustands-Item</a><br>
    <a href="?page=doku5">Bedingungen</a><br>
    <a href="?page=doku6">Aktionen: Ausführung</a><br>
    <a href="?page=doku7">Aktionen: Einzelangabe</a><br>
    <a href="?page=doku8">Aktionen: Combo-Angabe</a><br>
    <a href="?page=doku9">Zustand-Templates</a><br>
    <a href="?page=doku10">Vordefinierte Funktionen</a><br>
    <a href="?page=doku11">Variablen</a><br>
    <a href="?page=doku12">Sperr-Zustand</a><br>
    <a href="?page=doku13">Pausiert-Zustand</a><br>
    <a href="?page=doku14">CLI Kommandos</a><br>
    <a href="?page=doku15">Vollständiges Beispiel</a><br>
  </div>
  <div style="margin-left:230px; max-width: 800px;">
    <h1 id="vordefiniertefunktionen">Vordefinierte Funktionen</h1>

    <p>Das stateengine Plugin stellt verschiedene vordefinierte Funktionen zur Verfügung die einfach für "<code>se_set_&lt;Aktionsname&gt;</code>" und "<code>se_run_&lt;Aktionsname&gt;</code>" Aktionen verwendet werden können. Diese Funktionen sind in einer Klasse enthalten, die bei Bedarf für das Ausführen der Aktion instanziiert wird. Die folgenden Funktionen können verwendet werden:</p>

    <h2 id="winkelzumnachfhrenderjalousielamellenaufbasisdessonnenstandsberechnen">Winkel zum Nachführen der Jalousielamellen auf Basis des Sonnenstands berechnen</h2>

    <pre><code>stateengine_eval.sun_tracking()
    </code></pre>

    <h2 id="zufallszahl">Zufallszahl</h2>

    <pre><code>stateengine_eval.get_random_int(min,max)
    </code></pre>

    <p>Über "<code>min</code>" und "<code>max</code>" kann die kleinste/größte Nummer, die zurückgegeben werden soll, festgelegt werden. "<code>min</code>" und "<code>max</code>" können weggelassen werden, in diesem Fall sind die Vorgabewerte 0 für <code>min</code> und 255 für <code>max</code>.</p>

    <h2 id="shellkommandoausfhren">Shell-Kommando ausführen</h2>

    <pre><code>stateengine_eval.execute(command)
    </code></pre>

    <p>Führt das Shell-Kommando "<code>command</code>" aus</p>

    <h2 id="werteinervariableermitteln">Wert einer Variable ermitteln</h2>

    <pre><code>stateengine_eval.get_variable(varname)
    </code></pre>

    <p>Liefert den Wert der [[Variablen|Doku-De-Variablen]] "<code>varname</code>"</p>

    <h2 id="itemidrelativzumobjektitemermitteln">Item-Id relativ zum Objekt-Item ermitteln</h2>

    <pre><code>stateengine_eval.get_relative_itemid(subitem_id)
    </code></pre>

    <p>Eine Item-Id relativ zur Item-Id des Objekt-Items wird ermittelt. Die Ermittlung erfolgt dabei mit der gleichen Rotine, die zur [[relativen Ermittlung von Items|Doku-De-Grundsaetzliches-Relative-Itemangaben]] verwendet wird.</p>

    <h2 id="itemwertrelativzumobjektitemermitteln">Item-Wert relativ zum Objekt-Item ermitteln</h2>

    <pre><code>stateengine_eval.get_relative_itemvalue(subitem_id)
    </code></pre>

    <p>Der Wert eines Items relativ zur Item-Id des Objekt-Items wird ermittelt. Die Ermittlung erfolgt dabei mit der gleichen Rotine, die zur [[relativen Ermittlung von Items|Doku-De-Grundsaetzliches-Relative-Itemangaben]] verwendet wird.</p>

    <h2 id="suspendendeineinentexteinsetzen">Suspend-Ende in einen Text einsetzen</h2>

    <pre><code>stateengine_eval.insert_suspend_time(suspend_item_id, suspend_text="Ausgesetzt bis %X")
    </code></pre>

    <p>Das Ende der Suspend-Zeit wird in den Text "<code>suspend_text</code>" eingesetzt. Im Text sind daher entsprechende Platzhalter vorzusehen (Siehe <a href="https://docs.python.org/3/library/datetime.html#strftime-strptime-behavior">strftime() and strptime() Behavior</a>). Wird kein "<code>suspend_text</code>" angegeben, so wird als Vorgabewert "Ausgesetzt bis %X" verwendet.</p>

    <p>Zur Ermittlung des Endes der Suspend-Zeit muss über "<code>suspend_item_id</code>" ein Item angegeben werden, dessen Wert bei Eintritt in den Suspend-Status geändert wird. Über das Alter des Werts in diesem Item wird die bereits abgelaufene Suspend-Zeit bestimmt.</p>
  </div>
</div>
{% endblock bodytab1 %}
