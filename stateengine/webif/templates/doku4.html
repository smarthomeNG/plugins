{% extends "base_plugin.html" %}
{% block scripts %}
{{ super() }}
<script>
function mainpage() {
  var url = window.location.href;
  var page = url.substring(url.lastIndexOf('/') + 1);
  var final = url.replace(page, '');
  if ( url.includes("?action=") ) {
    window.location.href = final;
  };
}
</script>
{% endblock scripts %}
{% set logo_frame = false %}


{% set item_count = p.__items|length %}
{% set tab1title = "<strong>StateEngine</strong>" %}
{% set tabcount = 1 %}

{% block headtable %}

<table class="table table-striped table-hover">
  <tbody>
    <tr>
      <td class="py-1"><strong>Log Level</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_level') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Log Folder</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_directory') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Startup Delay</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('startup_delay_default') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Suspend Time</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('suspend_time_default') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Items</strong></td>
      <td class="py-1">{{ item_count }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"></td>
      <td class="py-1"></td>
    </tr>
  </tbody>
</table>
{% endblock headtable %}


{% block bodytab1 %}

<div class="container-fluid m-2" style="position: relative;">
  <div style="float: left; border:1px solid black; width:200px; position: sticky; position: -webkit-sticky; top:220px; left:0;">
    <a href="https://www.smarthomeng.de/starting-with-state-machine-automation-stateengine-plugin" target="link">Einführung</a><br>
    <a href="?page=doku1">Grundsätzliches</a><br>
    <a href="?page=doku2">Plugin-Konfiguration</a><br>
    <a href="?page=doku3">Das Objekt-Item</a><br>
    <a href="?page=doku4">Das Zustands-Item</a><br>
    <a href="?page=doku5">Bedingungen</a><br>
    <a href="?page=doku6">Aktionen: Ausführung</a><br>
    <a href="?page=doku7">Aktionen: Einzelangabe</a><br>
    <a href="?page=doku8">Aktionen: Combo-Angabe</a><br>
    <a href="?page=doku9">Zustand-Templates</a><br>
    <a href="?page=doku10">Vordefinierte Funktionen</a><br>
    <a href="?page=doku11">Variablen</a><br>
    <a href="?page=doku12">Sperr-Zustand</a><br>
    <a href="?page=doku13">Pausiert-Zustand</a><br>
    <a href="?page=doku14">CLI Kommandos</a><br>
    <a href="?page=doku15">Vollständiges Beispiel</a><br>
  </div>
  <div style="margin-left:230px; max-width: 800px;">
    <h1 id="zustndedaszustandsitem">Zustände: Das Zustands-Item</h1>

    <p>Alle Items unterhalb des Objekt-Items beschreiben Zustände des Objekts ("Zustands-Item"). Die Ids der Zustands-Items sind beliebig. Sie werden als Werte für das über "<code>se_laststate_item_id</code>" angegebene Item verwendet um den aktuellen Zustand abzulegen.</p>

    <pre><code>beispiel:
        raffstore1:
            automatik:
                rules:
                    Tag:
                        type: foo
                        name: Tag
                        se_name: eval: sh.eine_funktion()
    </code></pre>

    <p><strong>type (obligatorisch):</strong> <br />
    <em>Datentp des Items</em>  </p>

    <p>Für das Zustands-Item muss immer der Datentyp "foo" verwendet werden</p>

    <p><strong>name (optional):</strong> <br />
    <em>Name des Zustands</em>  </p>

    <p>Der Name des Zustands wird im Protokoll sowie als Wert für das über "<code>se_laststate_item_name</code>" angegebene Item verwendet. Wenn kein Name angegeben ist, wird hier ebenfalls die Id des Zustands-Items verwendet.</p>

    <p><strong>se_name (optional):</strong> <br />
    _Ermittlung des Namens des Zustands</em>  </p>

    <p>Über das Attribut "<code>se_name</code>" kann der im Attribut "<code>name</code>" überschrieben werden. Dies wirkt sich jedoch nur auf den Wert aus, der in das über "<code>se_laststate_item_name</code>" angegebene Item geschrieben wird. Im Protokoll wird immer der über das Attribut "<code>name</code>" angegebene Wert verwendet. <br />
    Der Parameter verwendet den [[Datentyp AbValue|Doku-De-Grundsaetzliches-AbValue]]</p>

    <h2 id="bedingungsgruppen">Bedingungsgruppen</h2>

    <p>Jeder Zustand kann eine beliebige Anzahl von Bedingungsgruppen haben. Jede Bedingungsgruppe definiert ein Set an Bedingungen das überprüft wird, wenn der aktuelle Status neu ermittelt wird. Sobald die Bedingungen einer Bedingungsgruppe vollständig erfüllt sind, kann der Status aktiv werden.</p>

    <p>Jede Bedingungsgruppe wird durch ein Item ("Bedingungsgruppen-Item") unterhalb des Zustands-Items abgebildet. Eine Bedingungsgruppe kann beliebig viele Bedingungen umfassen. Bedingungen werden als Attribute im Bedingungsgruppen-Item definiert. Details zu den Bedingungen werden im Abschnitt [[Bedingungen|Doku-De-Bedingungen]] erläutert.</p>

    <p>Die folgenden Regeln kommen zur Anwendung:</p>

    <ul>
    <li><p>Zustände und Bedingungsgruppen werden in der Reihenfolge geprüft, in der sie in der Konfigurationsdatei definiert sind.</p></li>

    <li><p>Eine einzelne Bedingungsgruppe ist erfüllt, wenn alle Bedingungen, die in der Bedingungsgruppe definiert sind, erfüllt sind (UND-Verknüpfung). Einschränkungen, die in der Bedingungsgruppe nicht definiert sind, werden nicht geprüft.</p></li>

    <li><p>Ein Zustand kann aktueller Zustand werden, wenn eine beliebige der definierten Bedingungsgruppen des Zustands erfüllt ist. Die Prüfung ist mit der ersten erfüllten Bedingungsgruppe beendet (ODER-Verknüpfung). </p></li>

    <li><p>Ein Zustand der keine Bedingungsgruppen hat kann immer aktueller Zustand werden. Solch ein Zustand kann als Default-Zustand am Ende der Zustände definiert werden.</p></li>
    </ul>

    <h2 id="aktionen">Aktionen</h2>

    <p>Jeder Zustand kann eine beliebige Anzahl an Aktionen definieren. Sobald ein Zustand aktueller Zustand wird werden die Aktionen des Zustands ausgeführt.
    Für die Aktionen gibt es vier Ereignisse, die festlegen, wann eine Aktion ausgeführt wird:</p>

    <ul>
    <li><p><strong>on_enter</strong>: Aktionen, die beim erstmaligen Aktivieren des Zustands ausgeführt werden</p></li>

    <li><p><strong>on_stay</strong>: Aktionen, die ausgeführt werden, wenn der Zustand zuvor bereits aktiv war und weiterhin aktiv bleibt.</p></li>

    <li><p><strong>on_enter</em>or_stay</strong>: Aktionen, die ausgeführt werden, wenn der Zustand aktiv ist, unabhängig davon, ob er bereits zuvor aktiv war oder nicht.</p></li>

    <li><p><strong>on_leave</strong>: Aktionen, die ausgeführt werden, direkt bevor ein anderer Zustand aktiv wird.</p>

    <p>Details zu den Aktionen werden im Abschnitt [[Aktionen|Doku-De-Aktionen]] erläutert.</p></li>
    </ul>

    <h2 id="items">Items</h2>

    <p>Bedingungen und Aktionen beziehen sich überlicherweise auf Items. Diese Items müssen auf Ebene des Objekt-Items über das Attribut "<code>se_item_&lt;Bedingungsname/Aktionsname&gt;</code>" bekannt gemacht werden.</p>

    <h2 id="beispiel">Beispiel</h2>

    <pre><code>beispiel:
        raffstore1:
            automatik:
                rules:
                    &lt;Allgemeine Objektkonfiguration&gt;

                    Tag:
                        type: foo
                        name: Tag
                        &lt;Aktionen bei Zustand "Tag"&gt;
                        enter:
                            &lt;Bedingungen&gt;
                    Nacht:
                        type: foo
                        name: Nacht
                        &lt;Aktionen bei Zustand "Nacht"&gt;
                        enter_todark:
                            &lt;Bedingungen um den Zustand anzusteuern, wenn es zu dunkel ist&gt;
                        enter_tolate:
                            &lt;Bedingungen um den Zustand anzusteuern, wenn es zu spät ist&gt;
    </code></pre>

    <p><strong>Attribute "<code>se_item_height</code>" und "<code>se_item_lamella</code>":</strong> <br />
    <em>Definition der Items, die durch die Aktionen "<code>se_set_height</code>" und "<code>se_set_lamella</code>" verändert werden</em>  </p>

    <p>Die Items werden durch ihre Item-Id angegeben</p>

    <p><strong>Attribut "<code>name</code>":</strong> <br />
    <em>Name des Zustands</em>  </p>

    <p>Der Name wird in das über "<code>se_laststate_item_name</code>" definierte Item geschrieben, wenn der Zustand aktueller Zustand wird. Dieser Wert kann z. B. in einer Visualisierung dargestellt werden.</p>

    <p><strong>Attribute "<code>se_set_height</code>" und "<code>se_set_leave</code>":</strong> <br />
    <em>Neue statische Werte für die Items die über "<code>se_item_height</code>" und "<code>se_item_leave</code>" festgelegt wurden</em>  </p>

    <p><strong>Untergeordnete Items  "<code>enter</code>", "<code>enter_todark</code>" und "<code>enter_tolate</code>":</strong> <br />
    <em>Bedingungsgruppen die erfüllt sein müssen, damit ein Zustand aktueller Zustand werden kann</em>  </p>

  </div>
</div>
{% endblock bodytab1 %}
