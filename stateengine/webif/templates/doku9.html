{% extends "base_plugin.html" %}
{% block scripts %}
{{ super() }}
<script>
function mainpage() {
  var url = window.location.href;
  var page = url.substring(url.lastIndexOf('/') + 1);
  var final = url.replace(page, '');
  if ( url.includes("?action=") ) {
    window.location.href = final;
  };
}
</script>
{% endblock scripts %}
{% set logo_frame = false %}


{% set item_count = p.__items|length %}
{% set tab1title = "<strong>StateEngine</strong>" %}
{% set tabcount = 1 %}

{% block headtable %}

<table class="table table-striped table-hover">
  <tbody>
    <tr>
      <td class="py-1"><strong>Log Level</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_level') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Log Folder</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('log_directory') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Startup Delay</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('startup_delay_default') }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"><strong>Suspend Time</strong></td>
      <td class="py-1">{{ p.get_parameter_value_for_display('suspend_time_default') }}</td>
    </tr>
    <tr>
      <td class="py-1"><strong>Items</strong></td>
      <td class="py-1">{{ item_count }}</td>
      <td class="py-1" width="50px"></td>
      <td class="py-1"></td>
      <td class="py-1"></td>
    </tr>
  </tbody>
</table>
{% endblock headtable %}


{% block bodytab1 %}

<div class="container-fluid m-2" style="position: relative;">
  <div style="float: left; border:1px solid black; width:200px; position: sticky; position: -webkit-sticky; top:220px; left:0;">
    <a href="https://www.smarthomeng.de/starting-with-state-machine-automation-stateengine-plugin" target="link">Einführung</a><br>
    <a href="?page=doku1">Grundsätzliches</a><br>
    <a href="?page=doku2">Plugin-Konfiguration</a><br>
    <a href="?page=doku3">Das Objekt-Item</a><br>
    <a href="?page=doku4">Das Zustands-Item</a><br>
    <a href="?page=doku5">Bedingungen</a><br>
    <a href="?page=doku6">Aktionen: Ausführung</a><br>
    <a href="?page=doku7">Aktionen: Einzelangabe</a><br>
    <a href="?page=doku8">Aktionen: Combo-Angabe</a><br>
    <a href="?page=doku9">Zustand-Templates</a><br>
    <a href="?page=doku10">Vordefinierte Funktionen</a><br>
    <a href="?page=doku11">Variablen</a><br>
    <a href="?page=doku12">Sperr-Zustand</a><br>
    <a href="?page=doku13">Pausiert-Zustand</a><br>
    <a href="?page=doku14">CLI Kommandos</a><br>
    <a href="?page=doku15">Vollständiges Beispiel</a><br>
  </div>
  <div style="margin-left:230px; max-width: 800px;">
    <h1 id="vorgabezustndeverwenden">Vorgabezustände verwenden</h1>

    <p>Es ist möglich Vorgabezustände in der Konfiguration zu definieren und diese später für konkrete Objekte anzuwenden. Dabei können im konkreten Zustand auch Einstellungen des Vorgabezustands überschrieben werden.</p>

    <p>Vorgabezustände werden als Item an beliebiger Stelle innerhalb der Item-Struktur definiert. Es ist sinnvoll, die Vorgabezustände unter eingem gemeinsamen Item zusammenzufassen. Innerhalb der Vorgabezustand-Items stehen die gleichen Möglichkeiten wie in normalen Zustands-Items zur Verfügung. Das dem Vorgabezustands-Item übergeordnete Item darf nicht das Attribut "<code>se_plugin: active</code>" haben. Im Item über dem Vorgabezustands-Item können jedoch Items über "<code>se_item_&lt;Bedingungsname|Aktionsname&gt;</code>" angegeben werden. Diese stehen in den Vorgabezuständen und in den von den Vorgabezuständen abgeleiteten Zuständen zur Verfügung und müssen so nicht jedes mal neu definiert werden.</p>

    <p>Im konkreten Zustands-Item kann das Vorgabezustand-Item über das Attribut</p>

    <pre><code>se_use: &lt;Id des Vorgabezustand-Item&gt;
    </code></pre>

    <p>eingebunden werden. Die Vorgabezustand-Items können geschachtelt werden, dass heißt ein Vorgabezustand kann also selbst wiederum über <code>se_use</code> von einem weiteren Vorgabezustand abgeleitet werden. Um unnötige Komplexität und Zirkelbezüge zu vermeiden ist die maximale Tiefe jedoch auf 5 Ebenen begrenzt.</p>

    <h2 id="beispiel">Beispiel</h2>

    <pre><code>beispiel:
        default:
            &lt;...&gt;
            se_item_height: ...hoehe
            Nacht:
                &lt;...&gt;
                enter:
                    (...)
                se_set_height: value:100
                se_set_lamella: 0
            Morgens:
                &lt;...&gt;
                enter:
                    &lt;...&gt;
                se_set_height: value:100
                se_set_lamella: 25

            Abends:
                &lt;...&gt;
                enter:
                    &lt;...&gt;
                se_set_height: value:100
                se_set_lamella: 75

            Tag:
                &lt;...&gt;
                enter:
                    &lt;...&gt;
                se_set_height: value:0
                se_set_lamella: 100

    beispiel
        raffstore1:
            automatik:
                rules:
                    &lt;...&gt;
                    se_item_lamella: beispiel.raffstore1.lamelle
                    Nacht:
                        se_use: beispiel.default.Nacht
                        enter_additional:
                            &lt;... zusätzliche Einstiegsbedingung ...&gt;
                    Morgens:
                        se_use: beispiel.default.Morgens
                    Abends:
                        se_use: beispiel.default.Abends
                        enter:
                            &lt;... Änderungen an der Einstiegsbedingung des Vorgabezustands ...&gt;
                    Nachfuehren:
                        &lt;...&gt;
                        name: Zusätzlicher Zustand, der nicht aus den Vorgabezuständen kommt
                        se_set_height: value:100
                        se_set_lamella: eval:stateengine_eval.sun_tracking()
                    Tag:
                        se_use: stateengine.default.day
    </code></pre>
  </div>
</div>
{% endblock bodytab1 %}
