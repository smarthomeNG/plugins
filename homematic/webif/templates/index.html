<!DOCTYPE html>
{% extends "base_plugin.html" %}

{% set logo_frame = false %}
{% set use_bodytabs = true %}

{% block headtable %}	
<table class="table table-striped table-hover">
	<tbody>
		<tr>
			<td class="py-1" width="200"><strong>Interface Typ</strong></td>
			<td class="py-1">{{ interface.TYPE }}</td>
			<td class="py-1" width="200"><strong>Verbunden</strong></td>
			<td class="py-1">{% if interface.CONNECTED %}Ja{% else %}Nein{% endif %}</td>
			<td width="100"></td>
		</tr>
		<tr>
			<td class="py-1"><strong>Adresse</strong></td>
			<td class="py-1">{{ interface.ADDRESS }}</td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td class="py-1"><strong>Firmware</strong></td>
			<td class="py-1">{{ interface.FIRMWARE_VERSION }}</td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
	</tbody>
</table>
{% endblock %}	


{% block buttons %}
{% if interface.CONNECTED %}
	<form action="" method="post">
	<button id="btn1" class="btn btn-shng btn-sm" name="learn" type="submit" value="on"><i class="fas fa-wifi"></i>&nbsp;&nbsp;&nbsp;Device Anlernen&nbsp;</button>
	<button id="btn1" class="btn btn-shng btn-sm" name="reload" type="submit" value="on"><i class="fas fa-redo"></i>&nbsp;&nbsp;&nbsp;neu laden&nbsp;</button>
<!--
	<input type="submit" class="btn btn-shng btn-sm" value="{{ 'Device Anlernen' }}"/>
-->
	</form>
<!--
	<button id="learn" class="btn btn-shng btn-sm" title="{{ 'Device Anlernen' }}" onclick="doLearn();" ><i class="fas fa-wifi"></i>&nbsp;&nbsp;&nbsp;{{ 'Device Anlernen' }}</button>

	<script type="text/javascript" language="javascript">
		function doLearn() {
			window.location = '?learn=on';
		};

		function sleep(ms) {
			return new Promise(resolve => setTimeout(resolve, ms));
		}
	</script>
-->
{% endif %}
{% endblock %}


{% block itemstab %}
<div class="table-responsive" style="margin-left: 2px; margin-right: 2px;" class="row">
	<div class="col-sm-12">
		<table class="table table-striped table-hover pluginList">
			<thead>
				<tr class="shng_heading">
					<th class="py-1">Item</th>
					<th class="py-1">Type</th>
					<th class="py-1">Wert</th>
					<th class="py-1">HM Adresse</th>
					<th class="py-1">HM Channel</th>
					<th class="py-1">HM Function</th>
					<th class="py-1">HM Node</th>
					<th class="py-1" width="200px"></th>
				</tr>
			</thead>
			<tbody>
				{% for i in items|sort %}
					<tr style="cursor: pointer;">
						<td class="py-1">{{ i[1] }}</td>
						<td class="py-1">{{ i[1].type() }}</td>
						<td class="py-1">{{ i[1]() }}</td>
						<td class="py-1">{{ i[2] }}</td>
						{% if not i[4] %}
								<td colspan="3" class="py-1" style="color: red; font-weight: bold;">Kein Device mit der Adresse gefunden</td>
						{% elif not i[3] %}
								<td colspan="3" class="py-1" style="color: red; font-weight: bold;">Function {{ i[4] }} nicht gefunden</td>
						{% elif not i[5] %}
								<td colspan="3" class="py-1" style="color: red; font-weight: bold;">Function {{ i[4] }} existiert nicht f√ºr Channel {{ i[3] }}</td>
						{% else %}
							<td class="py-1">{{ i[3] }}</td>
							<td class="py-1">{{ i[4] }}</td>
							<td class="py-1">{{ i[5] }}</td>
						{% endif %}
						<td class="py-1"></td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>
{% endblock %}


{% block devicestab %}
<div class="table-responsive" style="margin-left: 2px; margin-right: 2px;" class="row">
	<div class="col-sm-12">

		<table class="table table-striped table-hover pluginList">
			<thead>
				<tr class="shng_heading">
					<th class="py-1">Name</th>
					<th class="py-1">Adresse</th>
					<th class="py-1">HM-Type</th>
					<th class="py-1">Type</th>
					<th class="py-1">Firmware</th>
					<th class="py-1">Version</th>
					<th class="py-1">RSSI</td>
					<th class="py-1" width="200px"></th>
				</tr>
			</thead>
			<tbody>
				{% for d in devices|sort(attribute='name') %}
					<tr id="{{ loop.index }}_click" style="cursor: pointer;">
						<td class="py-1">{{ d.name }}</td>
						<td class="py-1">{{ d.address }}</td>
						<td class="py-1">{{ d.hmtype }}</td>
						<td class="py-1">{{ d.type }}</td>
						<td class="py-1">{{ d.firmware }}</td>
						<td class="py-1">{{ d.version }}</td>
						<td class="py-1">{{ d.dev.getAttributeData('RSSI_DEVICE') }}</td>
						<td class="py-1"></td>
					</tr>
					<tr id="{{ loop.index }}_additional" style="display: none; cursor: pointer;">
						<td class="py-1" colspan="10">
							<div class="card">

								<div class="card-body p-1">
									<table class="table mb-0">
										<thead>
											<tr>
												<th class="p-0" width="150">Node</td>
												<th class="p-0">Data</td>
											</tr>
										</thead>
										    {% if d.dev.ACTIONNODE != {} %}
											<tr>
												<td class="p-0">{{ 'ACTIONNODE' }}</td>
												<td class="p-0">{{ d.dev.ACTIONNODE }}</td>
											</tr>
											{% endif %}
										    {% if d.dev.ATTRIBUTENODE != {} %}
											<tr>
												<td class="p-0">{{ 'ATTRIBUTENODE' }}</td>
												<td class="p-0">{{ d.dev.ATTRIBUTENODE }}</td>
											</tr>
											{% endif %}
										    {% if d.dev.BINARYNODE != {} %}
											<tr>
												<td class="p-0">{{ 'BINARYNODE' }}</td>
												<td class="p-0">{{ d.dev.BINARYNODE }}</td>
											</tr>
											{% endif %}
										    {% if d.dev.EVENTNODE != {} %}
											<tr>
												<td class="p-0">{{ 'EVENTNODE' }}</td>
												<td class="p-0">{{ d.dev.EVENTNODE }}</td>
											</tr>
											{% endif %}
										    {% if d.dev.SENSORNODE != {} %}
											<tr>
												<td class="p-0">{{ 'SENSORNODE' }}</td>
												<td class="p-0">{{ d.dev.SENSORNODE }}</td>
											</tr>
											{% endif %}
										    {% if d.dev.WRITENODE != {} %}
											<tr>
												<td class="p-0">{{ 'WRITENODE' }}</td>
												<td class="p-0">{{ d.dev.WRITENODE }}</td>
											</tr>
											{% endif %}
									</table>
								</div>

							</div>
						</td>
					</tr>
					<script>
						/* If foldable content: add onclick for table row, stop unfolding when clicking pypi link inside. */
						$('#{{ loop.index }}_click').click(function(){
							$('#{{ loop.index }}_additional').toggle();
						});
						$('#{{ loop.index }}_additional').click(function(){
							$('#{{ loop.index }}_additional').toggle();
						});
					</script>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>
{% endblock %}

