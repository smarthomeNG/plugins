 <!DOCTYPE html>
{% extends "base.html" %}
{% import "navbar.html" as nav with context %}
{% block navbar %}
	{{ nav }}
{% endblock navbar %}

{% block content %}
<div class="container-fluid navBorder">
<h4>SmarthomeNG {{ _('Logfile') }}: {{ logfile }}</h4>
</div>
<div class="container-fluid">
    <div class="form-group" style="display:inline;">
        <div style="float:left; font-size: 20px;">{{ _('Filter') }}:</div>
        <input type="text" class="form-control form-control-sm" id="text_filter" value="{{ text_filter }}" style= "margin-left: 10px; width: 400px; float:left;"/>
        <select class="form-control form-control-sm" id="log_level_filter" style="margin-left: 10px; width: 200px; float:left;">
            <option {% if log_level_filter=="ALL" %}selected{% endif %} value="ALL">ALL</option>
            <option {% if log_level_filter=="DEBUG" %}selected{% endif %} value="DEBUG">DEBUG</option>
            <option {% if log_level_filter=="INFO" %}selected{% endif %} value="INFO">INFO</option>
            <option {% if log_level_filter=="WARNING" %}selected{% endif %} value="WARNING">WARNING</option>
            <option {% if log_level_filter=="ERROR" %}selected{% endif %} value="ERROR">ERROR</option>
            <option {% if log_level_filter=="CRITICAL" %}selected{% endif %} value="CRITICAL">CRITICAL</option>
        </select>
    </div>
    <button type="button" class="btn btn-smarthomeng btn-sm" style="float:left; margin-left: 10px;" onclick="location.href='log_view.html?logfile={{ logfile }}&text_filter='+$('#text_filter').val()+'&log_level_filter='+$('#log_level_filter').val()">{{ _('Filter anwenden','button') }}</button>
    <button id="linewrapping" type="button" class="btn btn-outline-secondary btn-sm" style="float:left; margin-left: 10px;">{{ _('Zeilenumbruch') }}</button>&nbsp;
    <button type="button" title="{{ _('Neu Laden', 'button') }}" class="btn btn-smarthomeng btn-sm" style="float:left; margin-left: 10px;" onclick="location.href='log_view.html?logfile={{ logfile }}&text_filter='+$('#text_filter').val()+'&log_level_filter='+$('#log_level_filter').val()+'&page={{ current_page }}'"><i class="fas fa-sync" aria-hidden="true"></i></button>
    <button type="button" title="{{ _('Nach unten scrollen', 'button') }}" class="btn btn-smarthomeng btn-sm" style="float:left; margin-left: 10px;" onclick="logCodeMirror.execCommand('goDocEnd');"><i class="fa fa-arrow-circle-down" aria-hidden="true"></i></button>
</div>
<br style="clear:both;"/>
<div class="container-fluid" style="overflow: none;">
    <div style="border: 1px solid #ddd; margin-bottom: 10px;">
{% if log_lines %}<textarea autocomplete="off" id="log_file" name="log_file">{% for line in log_lines %}{% if not loop.last %}{{ line }}{% else %}{{ line  | replace('\n', '') }}{% endif %}{% endfor %}</textarea>{% else %}{{ _('no data available') }}{% endif %}
    </div>
</div>
<div class="container-fluid">
    <table>
        <tr>
            <td style="width: 31px; text-align: center;">
            <button type="button" id="fast-backward" class="btn btn-smarthomeng btn-sm" style="float:left;" onclick="location.href='log_view.html?logfile={{ logfile }}&text_filter='+$('#text_filter').val()+'&log_level_filter='+$('#log_level_filter').val()+'&page=1'"><i class="fa fa-fast-backward" aria-hidden="true"></i></button>
            </td>
            <td style="width: 31px; text-align: center;">
            <button type="button" id="step-backward" class="btn btn-smarthomeng btn-sm" style="float:left;" onclick="location.href='log_view.html?logfile={{ logfile }}&text_filter='+$('#text_filter').val()+'&log_level_filter='+$('#log_level_filter').val()+'&page={{ current_page-1 }}'"><i class="fa fa-step-backward" aria-hidden="true"></i></button>
            </td>
            <td style="width: 75px; font-weight: bold; text-align: center;">
            ({{ current_page }} / {{ pages }})
            </td>
            <td style="width: 31px; text-align: center;">
            <button type="button" id="step-forward" class="btn btn-smarthomeng btn-sm" style="float:left;" onclick="location.href='log_view.html?logfile={{ logfile }}&text_filter='+$('#text_filter').val()+'&log_level_filter='+$('#log_level_filter').val()+'&page={{ current_page+1 }}'"><i class="fa fa-step-forward" aria-hidden="true"></i></button>
            </td>
            <td style="width: 31px; text-align: center;">
            <button type="button" id="fast-forward" class="btn btn-smarthomeng btn-sm" style="float:left;" onclick="location.href='log_view.html?logfile={{ logfile }}&text_filter='+$('#text_filter').val()+'&log_level_filter='+$('#log_level_filter').val()+'&page={{ pages }}'"><i class="fa fa-fast-forward" aria-hidden="true"></i></button>
            </td>
            <td style="width: 300px; text-align: right;">
                <button type="button" class="btn btn-smarthomeng btn-sm" onclick="window.open('log_dump.html?logfile={{ logfile }}')">{{ _('Logfile speichern','button') }}</button>
            </td>
        </tr>
    </table>
</div>
<script type="text/javascript" language="javascript">
var logCodeMirror = CodeMirror.fromTextArea(document.getElementById("log_file"), {
    lineNumbers: true,
    mode: "{{ mode }}",
    readOnly: true,
    indentUnit: 4,
    lineSeparator: '\n',
    mode: 'ttcn',
    lineWrapping: false,
    firstLineNumber: {% if current_page > 1 %}{{ (current_page-1) * 1000 +1}}{% else %}1{% endif %},
    indentWithTabs: false
});

window.addEventListener("resize", function(){resizeCodeMirror(logCodeMirror, 75)}, false);
resizeCodeMirror(logCodeMirror, 75);

$('#linewrapping').click(function(e) {
    switchLineWrapping(logCodeMirror)
});

{% if current_page <= 1 %}$('#fast-backward').prop('disabled', true);$('#step-backward').prop('disabled', true);{% endif %}
{% if current_page >= pages %}$('#fast-forward').prop('disabled', true);$('#step-forward').prop('disabled', true);{% endif %}
</script>
{% endblock %}
